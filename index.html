<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Management System</title>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --success: #4cc9f0;
            --warning: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --gradient: linear-gradient(135deg, #4361ee, #3a0ca3);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: var(--dark);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header Styles */
        header {
            background: var(--gradient);
            color: white;
            padding: 15px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            width: 50px;
            height: 50px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--primary);
        }
        
        .school-name {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .profile-pic {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid white;
        }
        
        /* Login Page Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 80vh;
        }
        
        .login-form {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
        }
        
        .login-form h2 {
            text-align: center;
            margin-bottom: 20px;
            color: var(--primary);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: var(--gradient);
            color: white;
        }
        
        .btn-primary:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .btn-full {
            width: 100%;
        }
        
        .portal-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .portal-btn {
            flex: 1;
            background: #e9ecef;
            color: var(--dark);
            text-align: center;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .portal-btn.active {
            background: var(--gradient);
            color: white;
        }
        
        /* Dashboard Styles */
        .dashboard {
            display: none;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .tab {
            padding: 15px 20px;
            cursor: pointer;
            flex: 1;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            background: var(--gradient);
            color: white;
        }
        
        .tab-content {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Card Styles */
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        tr:hover {
            background-color: #f8f9fa;
        }
        
        /* Status Badges */
        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-approved {
            background: #d1edff;
            color: #0c5460;
        }
        
        .status-revision {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-present {
            background: #d4edda;
            color: #155724;
        }
        
        .status-absent {
            background: #f8d7da;
            color: #721c24;
        }
        
        /* Form Styles */
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-col {
            flex: 1;
        }
        
        /* Action Buttons */
        .action-btn {
            padding: 5px 10px;
            margin: 0 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .btn-edit {
            background: #ffc107;
            color: var(--dark);
        }
        
        .btn-delete {
            background: #dc3545;
            color: white;
        }
        
        .btn-view {
            background: #17a2b8;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        /* Statistics */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="login-page" class="login-container">
        <div class="login-form">
            <div class="logo-container" style="justify-content: center; margin-bottom: 20px;">
                <div class="logo">SMS</div>
                <div class="school-name">School Management System</div>
            </div>
            
            <div class="portal-selector">
                <div class="portal-btn active" id="teacher-portal-btn">Teacher Portal</div>
                <div class="portal-btn" id="admin-portal-btn">Admin Portal</div>
                <div class="portal-btn" id="student-portal-btn">Student Portal</div>
            </div>
            
            <h2 id="login-title">Teacher Login</h2>
            
            <form id="login-form">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" required>
                </div>
                
                <div class="form-group" id="class-select-group" style="display: none;">
                    <label for="class-select">Class</label>
                    <select id="class-select">
                        <option value="">Select Class</option>
                    </select>
                </div>
                
                <button type="submit" class="btn btn-primary btn-full">Login</button>
            </form>
            
            <div id="login-message" style="margin-top: 15px; text-align: center; color: red;"></div>
            
            <div style="margin-top: 20px; text-align: center;">
                <p><strong>Default Logins:</strong></p>
                <p>Admin: admin / admin123</p>
                <p>Teacher: teacher1 / pass123</p>
                <p>Student: student1 / pass123 (Class: Primary 5)</p>
            </div>
        </div>
    </div>
    
    <!-- Teacher Dashboard -->
    <div id="teacher-dashboard" class="dashboard">
        <header>
            <div class="container header-content">
                <div class="logo-container">
                    <div class="logo">SMS</div>
                    <div class="school-name">Teacher Portal</div>
                </div>
                <div class="user-info">
                    <img id="teacher-profile-pic" src="" alt="Profile" class="profile-pic">
                    <span id="teacher-name">Teacher Name</span>
                    <button id="teacher-logout" class="btn" style="background: rgba(255,255,255,0.2); color: white;">Logout</button>
                </div>
            </div>
        </header>
        
        <div class="container">
            <div class="dashboard-header">
                <h1>Teacher Dashboard</h1>
                <div>
                    <span id="teacher-date-time"></span>
                </div>
            </div>
            
            <div class="tabs">
                <div class="tab active" data-tab="attendance">Attendance</div>
                <div class="tab" data-tab="lesson-notes">Lesson Notes</div>
                <div class="tab" data-tab="assignments">Assignments</div>
                <div class="tab" data-tab="students">My Students</div>
                <div class="tab" data-tab="profile">Profile</div>
            </div>
            
            <!-- Attendance Tab -->
            <div id="attendance-tab" class="tab-content active">
                <div class="card">
                    <div class="card-header">
                        <h2>Today's Attendance</h2>
                        <div id="attendance-status" class="status-badge status-absent">Not Marked</div>
                    </div>
                    <div id="attendance-details">
                        <p>Arrival Time: <span id="arrival-time">-</span></p>
                        <p>Departure Time: <span id="departure-time">-</span></p>
                    </div>
                </div>
                
                <div class="card">
                    <h2>Attendance History</h2>
                    <table id="attendance-history">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Arrival Time</th>
                                <th>Departure Time</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Attendance history will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Lesson Notes Tab -->
            <div id="lesson-notes-tab" class="tab-content">
                <div class="card">
                    <h2>Submit Lesson Note</h2>
                    <form id="lesson-note-form">
                        <div class="form-row">
                            <div class="form-col">
                                <label for="subject">Subject</label>
                                <input type="text" id="subject" required>
                            </div>
                            <div class="form-col">
                                <label for="topic">Topic</label>
                                <input type="text" id="topic" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="objectives">Learning Objectives</label>
                            <textarea id="objectives" rows="3" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="content">Lesson Content</label>
                            <textarea id="content" rows="5" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="evaluation">Evaluation Methods</label>
                            <textarea id="evaluation" rows="3" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;"></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Submit Lesson Note</button>
                    </form>
                </div>
                
                <div class="card">
                    <h2>Lesson Note History</h2>
                    <table id="lesson-notes-history">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Subject</th>
                                <th>Topic</th>
                                <th>Status</th>
                                <th>Grade</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Lesson notes history will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Assignments Tab -->
            <div id="assignments-tab" class="tab-content">
                <div class="card">
                    <h2>Create Assignment</h2>
                    <form id="assignment-form">
                        <div class="form-row">
                            <div class="form-col">
                                <label for="assignment-title">Title</label>
                                <input type="text" id="assignment-title" required>
                            </div>
                            <div class="form-col">
                                <label for="assignment-subject">Subject</label>
                                <input type="text" id="assignment-subject" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="assignment-description">Description</label>
                            <textarea id="assignment-description" rows="4" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;"></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <label for="due-date">Due Date</label>
                                <input type="date" id="due-date" required>
                            </div>
                            <div class="form-col">
                                <label for="assignment-image">Assignment Image (Optional)</label>
                                <input type="file" id="assignment-image" accept="image/*">
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Create Assignment</button>
                    </form>
                </div>
                
                <div class="card">
                    <h2>Assignment History</h2>
                    <table id="assignments-history">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Subject</th>
                                <th>Due Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Assignments history will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- My Students Tab -->
            <div id="students-tab" class="tab-content">
                <div class="card">
                    <h2>My Students</h2>
                    <table id="my-students-list">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Username</th>
                                <th>Class</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Students list will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Profile Tab -->
            <div id="profile-tab" class="tab-content">
                <div class="card">
                    <h2>Teacher Profile</h2>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="teacher-fullname">Full Name</label>
                            <input type="text" id="teacher-fullname" disabled>
                        </div>
                        <div class="form-col">
                            <label for="teacher-username">Username</label>
                            <input type="text" id="teacher-username" disabled>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="teacher-email">Email</label>
                            <input type="email" id="teacher-email">
                        </div>
                        <div class="form-col">
                            <label for="teacher-phone">Phone</label>
                            <input type="text" id="teacher-phone">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="teacher-subjects">Subjects</label>
                        <input type="text" id="teacher-subjects" disabled>
                    </div>
                    
                    <div class="form-group">
                        <label for="teacher-class">Assigned Class</label>
                        <input type="text" id="teacher-class" disabled>
                    </div>
                    
                    <div class="form-group">
                        <label for="teacher-profile-pic-upload">Profile Picture</label>
                        <input type="file" id="teacher-profile-pic-upload" accept="image/*">
                    </div>
                    
                    <button id="update-teacher-profile" class="btn btn-primary">Update Profile</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Admin Dashboard -->
    <div id="admin-dashboard" class="dashboard">
        <header>
            <div class="container header-content">
                <div class="logo-container">
                    <div class="logo">SMS</div>
                    <div class="school-name">Admin Portal</div>
                </div>
                <div class="user-info">
                    <img id="admin-profile-pic" src="" alt="Profile" class="profile-pic">
                    <span id="admin-name">Admin Name</span>
                    <button id="admin-logout" class="btn" style="background: rgba(255,255,255,0.2); color: white;">Logout</button>
                </div>
            </div>
        </header>
        
        <div class="container">
            <div class="dashboard-header">
                <h1>Admin Dashboard</h1>
                <div>
                    <span id="admin-date-time"></span>
                </div>
            </div>
            
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-value" id="total-teachers">0</div>
                    <div class="stat-label">Total Teachers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-students">0</div>
                    <div class="stat-label">Total Students</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="pending-lessons">0</div>
                    <div class="stat-label">Pending Lessons</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="today-attendance">0%</div>
                    <div class="stat-label">Today's Attendance</div>
                </div>
            </div>
            
            <div class="tabs">
                <div class="tab active" data-tab="teachers">Teacher Management</div>
                <div class="tab" data-tab="attendance-overview">Attendance</div>
                <div class="tab" data-tab="lesson-review">Lesson Review</div>
                <div class="tab" data-tab="assignments-overview">Assignments</div>
                <div class="tab" data-tab="students">Student Management</div>
                <div class="tab" data-tab="admin-profile">Profile & Settings</div>
            </div>
            
            <!-- Teacher Management Tab -->
            <div id="teachers-tab" class="tab-content active">
                <div class="card">
                    <h2>Add New Teacher</h2>
                    <form id="add-teacher-form">
                        <div class="form-row">
                            <div class="form-col">
                                <label for="new-teacher-name">Full Name</label>
                                <input type="text" id="new-teacher-name" required>
                            </div>
                            <div class="form-col">
                                <label for="new-teacher-username">Username</label>
                                <input type="text" id="new-teacher-username" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <label for="new-teacher-password">Password</label>
                                <input type="password" id="new-teacher-password" required>
                            </div>
                            <div class="form-col">
                                <label for="new-teacher-email">Email</label>
                                <input type="email" id="new-teacher-email">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <label for="new-teacher-subjects">Subjects (comma separated)</label>
                                <input type="text" id="new-teacher-subjects">
                            </div>
                            <div class="form-col">
                                <label for="new-teacher-class">Assign to Class</label>
                                <select id="new-teacher-class">
                                    <option value="">No Class</option>
                                    <option value="Nursery 1">Nursery 1</option>
                                    <option value="Nursery 2">Nursery 2</option>
                                    <option value="KG 1">KG 1</option>
                                    <option value="KG 2">KG 2</option>
                                    <option value="Primary 1">Primary 1</option>
                                    <option value="Primary 2">Primary 2</option>
                                    <option value="Primary 3">Primary 3</option>
                                    <option value="Primary 4">Primary 4</option>
                                    <option value="Primary 5">Primary 5</option>
                                    <option value="Primary 6">Primary 6</option>
                                    <option value="JHS 1">JHS 1</option>
                                    <option value="JHS 2">JHS 2</option>
                                    <option value="JHS 3">JHS 3</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="new-teacher-is-admin">Assign as Admin</label>
                            <input type="checkbox" id="new-teacher-is-admin">
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Add Teacher</button>
                    </form>
                </div>
                
                <div class="card">
                    <h2>All Teachers</h2>
                    <table id="teachers-list">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Username</th>
                                <th>Subjects</th>
                                <th>Class</th>
                                <th>Role</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Teachers list will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Attendance Overview Tab -->
            <div id="attendance-overview-tab" class="tab-content">
                <div class="card">
                    <h2>Today's Attendance</h2>
                    <table id="today-attendance-table">
                        <thead>
                            <tr>
                                <th>Teacher</th>
                                <th>Arrival Time</th>
                                <th>Departure Time</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Today's attendance will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <div class="card">
                    <h2>Mark Teacher Attendance</h2>
                    <form id="mark-attendance-form">
                        <div class="form-row">
                            <div class="form-col">
                                <label for="attendance-teacher">Select Teacher</label>
                                <select id="attendance-teacher" required>
                                    <option value="">Select Teacher</option>
                                </select>
                            </div>
                            <div class="form-col">
                                <label for="attendance-type">Attendance Type</label>
                                <select id="attendance-type" required>
                                    <option value="">Select Type</option>
                                    <option value="arrival">Arrival</option>
                                    <option value="departure">Departure</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Mark Attendance</button>
                    </form>
                </div>
                
                <div class="card">
                    <h2>Attendance History</h2>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="attendance-teacher-select">Select Teacher</label>
                            <select id="attendance-teacher-select">
                                <option value="">All Teachers</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label for="attendance-date-range">Date Range</label>
                            <input type="date" id="attendance-start-date"> to <input type="date" id="attendance-end-date">
                        </div>
                    </div>
                    <table id="attendance-history-admin">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Teacher</th>
                                <th>Arrival Time</th>
                                <th>Departure Time</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Attendance history will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Lesson Review Tab -->
            <div id="lesson-review-tab" class="tab-content">
                <div class="card">
                    <h2>Lesson Notes for Review</h2>
                    <table id="lessons-for-review">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Teacher</th>
                                <th>Subject</th>
                                <th>Topic</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Lessons for review will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Assignments Overview Tab -->
            <div id="assignments-overview-tab" class="tab-content">
                <div class="card">
                    <h2>All Assignments</h2>
                    <table id="all-assignments">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Teacher</th>
                                <th>Subject</th>
                                <th>Due Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- All assignments will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Student Management Tab -->
            <div id="students-tab" class="tab-content">
                <div class="card">
                    <h2>Add Student to Class</h2>
                    <form id="add-student-form">
                        <div class="form-row">
                            <div class="form-col">
                                <label for="student-name">Full Name</label>
                                <input type="text" id="student-name" required>
                            </div>
                            <div class="form-col">
                                <label for="student-class">Class</label>
                                <select id="student-class" required>
                                    <option value="">Select Class</option>
                                    <option value="Nursery 1">Nursery 1</option>
                                    <option value="Nursery 2">Nursery 2</option>
                                    <option value="KG 1">KG 1</option>
                                    <option value="KG 2">KG 2</option>
                                    <option value="Primary 1">Primary 1</option>
                                    <option value="Primary 2">Primary 2</option>
                                    <option value="Primary 3">Primary 3</option>
                                    <option value="Primary 4">Primary 4</option>
                                    <option value="Primary 5">Primary 5</option>
                                    <option value="Primary 6">Primary 6</option>
                                    <option value="JHS 1">JHS 1</option>
                                    <option value="JHS 2">JHS 2</option>
                                    <option value="JHS 3">JHS 3</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <label for="student-username">Username</label>
                                <input type="text" id="student-username" required>
                            </div>
                            <div class="form-col">
                                <label for="student-password">Password</label>
                                <input type="password" id="student-password" required>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Add Student</button>
                    </form>
                </div>
                
                <div class="card">
                    <h2>All Students</h2>
                    <table id="students-list">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Username</th>
                                <th>Class</th>
                                <th>Teacher</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Students list will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Admin Profile Tab -->
            <div id="admin-profile-tab" class="tab-content">
                <div class="card">
                    <h2>Admin Profile</h2>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="admin-fullname">Full Name</label>
                            <input type="text" id="admin-fullname">
                        </div>
                        <div class="form-col">
                            <label for="admin-username">Username</label>
                            <input type="text" id="admin-username" disabled>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="admin-email">Email</label>
                            <input type="email" id="admin-email">
                        </div>
                        <div class="form-col">
                            <label for="admin-phone">Phone</label>
                            <input type="text" id="admin-phone">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="admin-profile-pic-upload">Profile Picture</label>
                        <input type="file" id="admin-profile-pic-upload" accept="image/*">
                    </div>
                    
                    <div class="form-group">
                        <label for="school-logo-upload">School Logo</label>
                        <input type="file" id="school-logo-upload" accept="image/*">
                    </div>
                    
                    <button id="update-admin-profile" class="btn btn-primary">Update Profile</button>
                    <button id="save-school-logo" class="btn btn-primary">Save School Logo</button>
                </div>
                
                <div class="card">
                    <h2>System Settings</h2>
                    <div class="form-group">
                        <label for="school-name-input">School Name</label>
                        <input type="text" id="school-name-input" value="School Management System">
                    </div>
                    
                    <div class="form-group">
                        <label for="auto-logout">Auto Logout After (minutes)</label>
                        <input type="number" id="auto-logout" value="30" min="5">
                    </div>
                    
                    <button id="save-settings" class="btn btn-primary">Save Settings</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Student Dashboard -->
    <div id="student-dashboard" class="dashboard">
        <header>
            <div class="container header-content">
                <div class="logo-container">
                    <div class="logo">SMS</div>
                    <div class="school-name">Student Portal</div>
                </div>
                <div class="user-info">
                    <span id="student-name">Student Name</span>
                    <span id="student-class-display">Class</span>
                    <button id="student-logout" class="btn" style="background: rgba(255,255,255,0.2); color: white;">Logout</button>
                </div>
            </div>
        </header>
        
        <div class="container">
            <div class="dashboard-header">
                <h1>Student Dashboard</h1>
                <div>
                    <span id="student-date-time"></span>
                </div>
            </div>
            
            <div class="tabs">
                <div class="tab active" data-tab="student-assignments">Assignments</div>
                <div class="tab" data-tab="student-profile">Profile</div>
            </div>
            
            <!-- Student Assignments Tab -->
            <div id="student-assignments-tab" class="tab-content active">
                <div class="card">
                    <h2>My Assignments</h2>
                    <table id="student-assignments">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Subject</th>
                                <th>Teacher</th>
                                <th>Due Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Student assignments will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Student Profile Tab -->
            <div id="student-profile-tab" class="tab-content">
                <div class="card">
                    <h2>Student Profile</h2>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="student-fullname">Full Name</label>
                            <input type="text" id="student-fullname" disabled>
                        </div>
                        <div class="form-col">
                            <label for="student-username-display">Username</label>
                            <input type="text" id="student-username-display" disabled>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="student-class-profile">Class</label>
                            <input type="text" id="student-class-profile" disabled>
                        </div>
                        <div class="form-col">
                            <label for="student-teacher">Teacher</label>
                            <input type="text" id="student-teacher" disabled>
                        </div>
                    </div>
                    
                    <button id="change-student-password" class="btn btn-primary">Change Password</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize data structure
        function initializeData() {
            if (!localStorage.getItem('schoolData')) {
                const defaultData = {
                    schoolName: "School Management System",
                    schoolLogo: "",
                    settings: {
                        autoLogout: 30
                    },
                    teachers: [
                        {
                            id: 1,
                            name: "John Doe",
                            username: "teacher1",
                            password: "pass123",
                            email: "teacher1@school.com",
                            phone: "123-456-7890",
                            subjects: "Mathematics, Science",
                            assignedClass: "Primary 5",
                            isAdmin: false,
                            profilePic: ""
                        }
                    ],
                    admins: [
                        {
                            id: 1,
                            name: "Admin User",
                            username: "admin",
                            password: "admin123",
                            email: "admin@school.com",
                            phone: "098-765-4321",
                            profilePic: ""
                        }
                    ],
                    students: [
                        {
                            id: 1,
                            name: "Student One",
                            username: "student1",
                            password: "pass123",
                            class: "Primary 5"
                        }
                    ],
                    attendance: [],
                    lessonNotes: [],
                    assignments: []
                };
                
                localStorage.setItem('schoolData', JSON.stringify(defaultData));
            }
            
            return JSON.parse(localStorage.getItem('schoolData'));
        }
        
        // Save data to localStorage
        function saveData(data) {
            localStorage.setItem('schoolData', JSON.stringify(data));
        }
        
        // Get current user
        function getCurrentUser() {
            return JSON.parse(localStorage.getItem('currentUser') || '{}');
        }
        
        // Set current user
        function setCurrentUser(user) {
            localStorage.setItem('currentUser', JSON.stringify(user));
        }
        
        // Clear current user
        function clearCurrentUser() {
            localStorage.removeItem('currentUser');
        }
        
        // Update date and time display
        function updateDateTime() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            
            const dateTimeString = now.toLocaleDateString('en-US', options);
            
            // Update all date-time displays
            const dateTimeElements = document.querySelectorAll('#teacher-date-time, #admin-date-time, #student-date-time');
            dateTimeElements.forEach(el => {
                if (el) el.textContent = dateTimeString;
            });
        }
        
        // Update school logo
        function updateSchoolLogo() {
            const data = initializeData();
            const logo = document.querySelector('.logo');
            if (data.schoolLogo) {
                logo.innerHTML = `<img src="${data.schoolLogo}" alt="School Logo" style="width: 100%; height: 100%; border-radius: 50%;">`;
            } else {
                logo.textContent = 'SMS';
            }
            
            // Update school name
            const schoolNameElements = document.querySelectorAll('.school-name');
            schoolNameElements.forEach(el => {
                if (el) el.textContent = data.schoolName;
            });
        }
        
        // Login functionality
        function setupLogin() {
            const loginForm = document.getElementById('login-form');
            const portalBtns = document.querySelectorAll('.portal-btn');
            const loginTitle = document.getElementById('login-title');
            const classSelectGroup = document.getElementById('class-select-group');
            
            // Portal selection
            portalBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    portalBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    if (this.id === 'teacher-portal-btn') {
                        loginTitle.textContent = 'Teacher Login';
                        classSelectGroup.style.display = 'none';
                    } else if (this.id === 'admin-portal-btn') {
                        loginTitle.textContent = 'Admin Login';
                        classSelectGroup.style.display = 'none';
                    } else if (this.id === 'student-portal-btn') {
                        loginTitle.textContent = 'Student Login';
                        classSelectGroup.style.display = 'block';
                        populateClassSelect();
                    }
                });
            });
            
            // Login form submission
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                const classSelect = document.getElementById('class-select').value;
                const activePortal = document.querySelector('.portal-btn.active').id;
                
                const data = initializeData();
                let user = null;
                let portal = '';
                
                if (activePortal === 'teacher-portal-btn') {
                    // Teacher login
                    user = data.teachers.find(t => t.username === username && t.password === password);
                    portal = 'teacher';
                } else if (activePortal === 'admin-portal-btn') {
                    // Admin login - check both admins array and teachers with admin privileges
                    user = data.admins.find(a => a.username === username && a.password === password);
                    if (!user) {
                        // Check if teacher is an admin
                        user = data.teachers.find(t => t.username === username && t.password === password && t.isAdmin);
                    }
                    portal = 'admin';
                } else if (activePortal === 'student-portal-btn') {
                    // Student login
                    if (!classSelect) {
                        showLoginMessage('Please select a class');
                        return;
                    }
                    user = data.students.find(s => s.username === username && s.password === password && s.class === classSelect);
                    portal = 'student';
                }
                
                if (user) {
                    user.portal = portal;
                    setCurrentUser(user);
                    showDashboard(portal);
                } else {
                    showLoginMessage('Invalid username, password, or class selection');
                }
            });
        }
        
        // Show login message
        function showLoginMessage(message) {
            const messageEl = document.getElementById('login-message');
            messageEl.textContent = message;
            setTimeout(() => {
                messageEl.textContent = '';
            }, 3000);
        }
        
        // Populate class select for student login
        function populateClassSelect() {
            const classSelect = document.getElementById('class-select');
            classSelect.innerHTML = '<option value="">Select Class</option>';
            
            const classes = [
                'Nursery 1', 'Nursery 2', 'KG 1', 'KG 2',
                'Primary 1', 'Primary 2', 'Primary 3', 'Primary 4', 'Primary 5', 'Primary 6',
                'JHS 1', 'JHS 2', 'JHS 3'
            ];
            
            classes.forEach(cls => {
                const option = document.createElement('option');
                option.value = cls;
                option.textContent = cls;
                classSelect.appendChild(option);
            });
        }
        
        // Show appropriate dashboard
        function showDashboard(portal) {
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('teacher-dashboard').style.display = 'none';
            document.getElementById('admin-dashboard').style.display = 'none';
            document.getElementById('student-dashboard').style.display = 'none';
            
            if (portal === 'teacher') {
                document.getElementById('teacher-dashboard').style.display = 'block';
                setupTeacherDashboard();
            } else if (portal === 'admin') {
                document.getElementById('admin-dashboard').style.display = 'block';
                setupAdminDashboard();
            } else if (portal === 'student') {
                document.getElementById('student-dashboard').style.display = 'block';
                setupStudentDashboard();
            }
            
            updateDateTime();
            updateSchoolLogo();
        }
        
        // Setup teacher dashboard
        function setupTeacherDashboard() {
            const user = getCurrentUser();
            
            // Display teacher info
            document.getElementById('teacher-name').textContent = user.name;
            if (user.profilePic) {
                document.getElementById('teacher-profile-pic').src = user.profilePic;
            }
            
            // Set up tab navigation
            setupTabs('teacher-dashboard');
            
            // Load teacher data
            loadTeacherAttendance();
            loadTeacherLessonNotes();
            loadTeacherAssignments();
            loadTeacherStudents();
            loadTeacherProfile();
            
            // Set up event listeners
            document.getElementById('teacher-logout').addEventListener('click', logout);
            document.getElementById('lesson-note-form').addEventListener('submit', submitLessonNote);
            document.getElementById('assignment-form').addEventListener('submit', createAssignment);
            document.getElementById('update-teacher-profile').addEventListener('click', updateTeacherProfile);
            document.getElementById('teacher-profile-pic-upload').addEventListener('change', handleTeacherProfilePicUpload);
        }
        
        // Setup admin dashboard
        function setupAdminDashboard() {
            const user = getCurrentUser();
            
            // Display admin info
            document.getElementById('admin-name').textContent = user.name;
            if (user.profilePic) {
                document.getElementById('admin-profile-pic').src = user.profilePic;
            }
            
            // Set up tab navigation
            setupTabs('admin-dashboard');
            
            // Load admin data
            loadAdminStatistics();
            loadTeachersList();
            loadAttendanceOverview();
            loadLessonsForReview();
            loadAllAssignments();
            loadStudentsList();
            loadAdminProfile();
            
            // Set up event listeners
            document.getElementById('admin-logout').addEventListener('click', logout);
            document.getElementById('add-teacher-form').addEventListener('submit', addNewTeacher);
            document.getElementById('mark-attendance-form').addEventListener('submit', markTeacherAttendanceAdmin);
            document.getElementById('add-student-form').addEventListener('submit', addNewStudent);
            document.getElementById('update-admin-profile').addEventListener('click', updateAdminProfile);
            document.getElementById('save-school-logo').addEventListener('click', saveSchoolLogo);
            document.getElementById('save-settings').addEventListener('click', saveSystemSettings);
            document.getElementById('admin-profile-pic-upload').addEventListener('change', handleAdminProfilePicUpload);
            document.getElementById('school-logo-upload').addEventListener('change', handleSchoolLogoUpload);
            
            // Set up filters
            document.getElementById('attendance-teacher-select').addEventListener('change', filterAttendanceHistory);
            document.getElementById('attendance-start-date').addEventListener('change', filterAttendanceHistory);
            document.getElementById('attendance-end-date').addEventListener('change', filterAttendanceHistory);
        }
        
        // Setup student dashboard
        function setupStudentDashboard() {
            const user = getCurrentUser();
            
            // Display student info
            document.getElementById('student-name').textContent = user.name;
            document.getElementById('student-class-display').textContent = user.class;
            
            // Set up tab navigation
            setupTabs('student-dashboard');
            
            // Load student data
            loadStudentAssignments();
            loadStudentProfile();
            
            // Set up event listeners
            document.getElementById('student-logout').addEventListener('click', logout);
            document.getElementById('change-student-password').addEventListener('click', changeStudentPassword);
        }
        
        // Setup tab navigation
        function setupTabs(dashboard) {
            const tabs = document.querySelectorAll(`#${dashboard} .tab`);
            const tabContents = document.querySelectorAll(`#${dashboard} .tab-content`);
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    
                    // Deactivate all tabs
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(tc => tc.classList.remove('active'));
                    
                    // Activate current tab
                    this.classList.add('active');
                    document.getElementById(`${tabName}-tab`).classList.add('active');
                    
                    // Refresh data if needed
                    if (dashboard === 'admin-dashboard') {
                        if (tabName === 'teachers') loadTeachersList();
                        if (tabName === 'attendance-overview') loadAttendanceOverview();
                        if (tabName === 'lesson-review') loadLessonsForReview();
                        if (tabName === 'assignments-overview') loadAllAssignments();
                        if (tabName === 'students') loadStudentsList();
                    } else if (dashboard === 'teacher-dashboard') {
                        if (tabName === 'students') loadTeacherStudents();
                    }
                });
            });
        }
        
        // Load teacher attendance (for teacher portal)
        function loadTeacherAttendance() {
            const user = getCurrentUser();
            const data = initializeData();
            
            // Filter attendance for current teacher
            const teacherAttendance = data.attendance.filter(a => a.teacherId === user.id);
            
            // Today's attendance
            const today = new Date().toDateString();
            const todayAttendance = teacherAttendance.find(a => new Date(a.date).toDateString() === today);
            
            if (todayAttendance) {
                document.getElementById('arrival-time').textContent = todayAttendance.arrivalTime || '-';
                document.getElementById('departure-time').textContent = todayAttendance.departureTime || '-';
                
                if (todayAttendance.departureTime) {
                    document.getElementById('attendance-status').textContent = 'Present';
                    document.getElementById('attendance-status').className = 'status-badge status-present';
                } else if (todayAttendance.arrivalTime) {
                    document.getElementById('attendance-status').textContent = 'Arrived';
                    document.getElementById('attendance-status').className = 'status-badge status-pending';
                }
            } else {
                document.getElementById('attendance-status').textContent = 'Absent';
                document.getElementById('attendance-status').className = 'status-badge status-absent';
            }
            
            // Attendance history
            const tbody = document.getElementById('attendance-history').querySelector('tbody');
            tbody.innerHTML = '';
            
            teacherAttendance.forEach(record => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(record.date).toLocaleDateString()}</td>
                    <td>${record.arrivalTime || '-'}</td>
                    <td>${record.departureTime || '-'}</td>
                    <td><span class="status-badge ${record.departureTime ? 'status-present' : record.arrivalTime ? 'status-pending' : 'status-absent'}">${record.departureTime ? 'Present' : record.arrivalTime ? 'Arrived' : 'Absent'}</span></td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Mark teacher attendance (by admin)
        function markTeacherAttendanceAdmin(e) {
            e.preventDefault();
            
            const data = initializeData();
            
            const teacherId = parseInt(document.getElementById('attendance-teacher').value);
            const attendanceType = document.getElementById('attendance-type').value;
            
            if (!teacherId || !attendanceType) {
                alert('Please select both teacher and attendance type');
                return;
            }
            
            const teacher = data.teachers.find(t => t.id === teacherId);
            if (!teacher) return;
            
            const today = new Date().toDateString();
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            // Find today's attendance record
            let attendanceRecord = data.attendance.find(a => 
                a.teacherId === teacherId && new Date(a.date).toDateString() === today
            );
            
            if (!attendanceRecord) {
                // Create new attendance record
                attendanceRecord = {
                    id: Date.now(),
                    teacherId: teacherId,
                    teacherName: teacher.name,
                    date: now.toISOString(),
                    arrivalTime: attendanceType === 'arrival' ? timeString : null,
                    departureTime: attendanceType === 'departure' ? timeString : null
                };
                data.attendance.push(attendanceRecord);
            } else {
                // Update existing record
                if (attendanceType === 'arrival') {
                    attendanceRecord.arrivalTime = timeString;
                } else if (attendanceType === 'departure') {
                    attendanceRecord.departureTime = timeString;
                }
            }
            
            saveData(data);
            
            // Reset form
            document.getElementById('mark-attendance-form').reset();
            
            // Reload attendance overview
            loadAttendanceOverview();
            
            alert(`Attendance marked successfully for ${teacher.name}`);
        }
        
        // Load teacher lesson notes
        function loadTeacherLessonNotes() {
            const user = getCurrentUser();
            const data = initializeData();
            
            // Filter lesson notes for current teacher
            const teacherLessonNotes = data.lessonNotes.filter(ln => ln.teacherId === user.id);
            
            const tbody = document.getElementById('lesson-notes-history').querySelector('tbody');
            tbody.innerHTML = '';
            
            teacherLessonNotes.forEach(note => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(note.date).toLocaleDateString()}</td>
                    <td>${note.subject}</td>
                    <td>${note.topic}</td>
                    <td><span class="status-badge ${note.status === 'approved' ? 'status-approved' : note.status === 'pending' ? 'status-pending' : 'status-revision'}">${note.status}</span></td>
                    <td>${note.grade || '-'}</td>
                    <td>
                        <button class="action-btn btn-view" onclick="viewLessonNote(${note.id})">View</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Submit lesson note
        function submitLessonNote(e) {
            e.preventDefault();
            
            const user = getCurrentUser();
            const data = initializeData();
            
            const subject = document.getElementById('subject').value;
            const topic = document.getElementById('topic').value;
            const objectives = document.getElementById('objectives').value;
            const content = document.getElementById('content').value;
            const evaluation = document.getElementById('evaluation').value;
            
            const lessonNote = {
                id: Date.now(),
                teacherId: user.id,
                teacherName: user.name,
                date: new Date().toISOString(),
                subject,
                topic,
                objectives,
                content,
                evaluation,
                status: 'pending',
                grade: null,
                feedback: null
            };
            
            data.lessonNotes.push(lessonNote);
            saveData(data);
            
            // Reset form
            document.getElementById('lesson-note-form').reset();
            
            // Reload lesson notes
            loadTeacherLessonNotes();
            
            alert('Lesson note submitted successfully!');
        }
        
        // Load teacher assignments
        function loadTeacherAssignments() {
            const user = getCurrentUser();
            const data = initializeData();
            
            // Filter assignments for current teacher
            const teacherAssignments = data.assignments.filter(a => a.teacherId === user.id);
            
            const tbody = document.getElementById('assignments-history').querySelector('tbody');
            tbody.innerHTML = '';
            
            teacherAssignments.forEach(assignment => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${assignment.title}</td>
                    <td>${assignment.subject}</td>
                    <td>${new Date(assignment.dueDate).toLocaleDateString()}</td>
                    <td><span class="status-badge status-pending">Active</span></td>
                    <td>
                        <button class="action-btn btn-view" onclick="viewAssignment(${assignment.id})">View</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Load teacher's students
        function loadTeacherStudents() {
            const user = getCurrentUser();
            const data = initializeData();
            
            // Filter students for teacher's class
            const teacherStudents = data.students.filter(s => s.class === user.assignedClass);
            
            const tbody = document.getElementById('my-students-list').querySelector('tbody');
            tbody.innerHTML = '';
            
            teacherStudents.forEach(student => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${student.name}</td>
                    <td>${student.username}</td>
                    <td>${student.class}</td>
                    <td>
                        <button class="action-btn btn-view" onclick="viewStudentDetails(${student.id})">View Details</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // View student details
        function viewStudentDetails(studentId) {
            const data = initializeData();
            const student = data.students.find(s => s.id === studentId);
            if (!student) return;
            
            alert(`
                Student Details:
                Name: ${student.name}
                Username: ${student.username}
                Class: ${student.class}
            `);
        }
        
        // Create assignment
        function createAssignment(e) {
            e.preventDefault();
            
            const user = getCurrentUser();
            const data = initializeData();
            
            const title = document.getElementById('assignment-title').value;
            const subject = document.getElementById('assignment-subject').value;
            const description = document.getElementById('assignment-description').value;
            const dueDate = document.getElementById('due-date').value;
            const imageFile = document.getElementById('assignment-image').files[0];
            
            let imageUrl = '';
            if (imageFile) {
                // In a real application, you would upload this to a server
                // For this demo, we'll create a data URL
                const reader = new FileReader();
                reader.onload = function(e) {
                    imageUrl = e.target.result;
                    completeAssignmentCreation(user, data, title, subject, description, dueDate, imageUrl);
                };
                reader.readAsDataURL(imageFile);
            } else {
                completeAssignmentCreation(user, data, title, subject, description, dueDate, imageUrl);
            }
        }
        
        function completeAssignmentCreation(user, data, title, subject, description, dueDate, imageUrl) {
            const assignment = {
                id: Date.now(),
                teacherId: user.id,
                teacherName: user.name,
                title,
                subject,
                description,
                dueDate,
                image: imageUrl,
                dateCreated: new Date().toISOString()
            };
            
            data.assignments.push(assignment);
            saveData(data);
            
            // Reset form
            document.getElementById('assignment-form').reset();
            
            // Reload assignments
            loadTeacherAssignments();
            
            alert('Assignment created successfully!');
        }
        
        // Load teacher profile
        function loadTeacherProfile() {
            const user = getCurrentUser();
            
            document.getElementById('teacher-fullname').value = user.name || '';
            document.getElementById('teacher-username').value = user.username || '';
            document.getElementById('teacher-email').value = user.email || '';
            document.getElementById('teacher-phone').value = user.phone || '';
            document.getElementById('teacher-subjects').value = user.subjects || '';
            document.getElementById('teacher-class').value = user.assignedClass || 'Not assigned';
        }
        
        // Update teacher profile
        function updateTeacherProfile() {
            const user = getCurrentUser();
            const data = initializeData();
            
            // Find the teacher in the data
            const teacherIndex = data.teachers.findIndex(t => t.id === user.id);
            if (teacherIndex === -1) return;
            
            // Update profile
            data.teachers[teacherIndex].email = document.getElementById('teacher-email').value;
            data.teachers[teacherIndex].phone = document.getElementById('teacher-phone').value;
            
            saveData(data);
            setCurrentUser(data.teachers[teacherIndex]);
            
            alert('Profile updated successfully!');
        }
        
        // Handle teacher profile picture upload
        function handleTeacherProfilePicUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const user = getCurrentUser();
            const data = initializeData();
            
            // Find the teacher in the data
            const teacherIndex = data.teachers.findIndex(t => t.id === user.id);
            if (teacherIndex === -1) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                data.teachers[teacherIndex].profilePic = e.target.result;
                saveData(data);
                setCurrentUser(data.teachers[teacherIndex]);
                
                // Update profile picture display
                document.getElementById('teacher-profile-pic').src = e.target.result;
                
                alert('Profile picture updated successfully!');
            };
            reader.readAsDataURL(file);
        }
        
        // Load admin statistics
        function loadAdminStatistics() {
            const data = initializeData();
            
            document.getElementById('total-teachers').textContent = data.teachers.length;
            document.getElementById('total-students').textContent = data.students.length;
            
            const pendingLessons = data.lessonNotes.filter(ln => ln.status === 'pending').length;
            document.getElementById('pending-lessons').textContent = pendingLessons;
            
            // Calculate today's attendance percentage
            const today = new Date().toDateString();
            const todayAttendance = data.attendance.filter(a => new Date(a.date).toDateString() === today && a.arrivalTime);
            const attendancePercentage = data.teachers.length > 0 ? 
                Math.round((todayAttendance.length / data.teachers.length) * 100) : 0;
            document.getElementById('today-attendance').textContent = `${attendancePercentage}%`;
        }
        
        // Load teachers list
        function loadTeachersList() {
            const data = initializeData();
            const tbody = document.getElementById('teachers-list').querySelector('tbody');
            tbody.innerHTML = '';
            
            // Also populate the teacher selects for attendance
            const attendanceTeacherSelect = document.getElementById('attendance-teacher');
            const attendanceTeacherFilter = document.getElementById('attendance-teacher-select');
            
            attendanceTeacherSelect.innerHTML = '<option value="">Select Teacher</option>';
            attendanceTeacherFilter.innerHTML = '<option value="">All Teachers</option>';
            
            data.teachers.forEach(teacher => {
                // Add to teachers list table
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${teacher.name}</td>
                    <td>${teacher.username}</td>
                    <td>${teacher.subjects || 'Not assigned'}</td>
                    <td>${teacher.assignedClass || 'Not assigned'}</td>
                    <td>${teacher.isAdmin ? 'Admin' : 'Teacher'}</td>
                    <td>
                        <button class="action-btn btn-edit" onclick="editTeacher(${teacher.id})">Edit</button>
                        <button class="action-btn btn-delete" onclick="deleteTeacher(${teacher.id})">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
                
                // Add to teacher selects for attendance
                const option = document.createElement('option');
                option.value = teacher.id;
                option.textContent = teacher.name;
                attendanceTeacherSelect.appendChild(option.cloneNode(true));
                attendanceTeacherFilter.appendChild(option);
            });
        }
        
        // Add new teacher
        function addNewTeacher(e) {
            e.preventDefault();
            
            const data = initializeData();
            
            const name = document.getElementById('new-teacher-name').value;
            const username = document.getElementById('new-teacher-username').value;
            const password = document.getElementById('new-teacher-password').value;
            const email = document.getElementById('new-teacher-email').value;
            const subjects = document.getElementById('new-teacher-subjects').value;
            const assignedClass = document.getElementById('new-teacher-class').value;
            const isAdmin = document.getElementById('new-teacher-is-admin').checked;
            
            // Check if username already exists
            if (data.teachers.find(t => t.username === username) || 
                data.admins.find(a => a.username === username)) {
                alert('Username already exists. Please choose a different username.');
                return;
            }
            
            const newTeacher = {
                id: Date.now(),
                name,
                username,
                password,
                email,
                subjects,
                assignedClass,
                isAdmin,
                profilePic: ""
            };
            
            if (isAdmin) {
                // Also add to admins array
                data.admins.push({
                    id: newTeacher.id,
                    name: newTeacher.name,
                    username: newTeacher.username,
                    password: newTeacher.password,
                    email: newTeacher.email,
                    profilePic: ""
                });
            }
            
            data.teachers.push(newTeacher);
            saveData(data);
            
            // Reset form
            document.getElementById('add-teacher-form').reset();
            
            // Reload teachers list
            loadTeachersList();
            loadAdminStatistics();
            
            alert('Teacher added successfully!');
        }
        
        // Edit teacher
        function editTeacher(teacherId) {
            const data = initializeData();
            const teacher = data.teachers.find(t => t.id === teacherId);
            if (!teacher) return;
            
            // In a real application, you would show a modal or form to edit the teacher
            // For this demo, we'll use prompts
            const newName = prompt('Enter new name:', teacher.name);
            if (newName === null) return;
            
            const newSubjects = prompt('Enter new subjects (comma separated):', teacher.subjects || '');
            if (newSubjects === null) return;
            
            const newClass = prompt('Enter new class:', teacher.assignedClass || '');
            if (newClass === null) return;
            
            const newIsAdmin = confirm('Should this teacher be an admin?');
            
            // Update teacher
            teacher.name = newName;
            teacher.subjects = newSubjects;
            teacher.assignedClass = newClass;
            teacher.isAdmin = newIsAdmin;
            
            // Update admin status
            const adminIndex = data.admins.findIndex(a => a.id === teacherId);
            if (newIsAdmin && adminIndex === -1) {
                data.admins.push({
                    id: teacher.id,
                    name: teacher.name,
                    username: teacher.username,
                    password: teacher.password,
                    email: teacher.email,
                    profilePic: teacher.profilePic
                });
            } else if (!newIsAdmin && adminIndex !== -1) {
                data.admins.splice(adminIndex, 1);
            }
            
            saveData(data);
            loadTeachersList();
            
            alert('Teacher updated successfully!');
        }
        
        // Delete teacher
        function deleteTeacher(teacherId) {
            if (!confirm('Are you sure you want to delete this teacher?')) return;
            
            const data = initializeData();
            
            // Remove from teachers array
            const teacherIndex = data.teachers.findIndex(t => t.id === teacherId);
            if (teacherIndex !== -1) {
                data.teachers.splice(teacherIndex, 1);
            }
            
            // Remove from admins array if applicable
            const adminIndex = data.admins.findIndex(a => a.id === teacherId);
            if (adminIndex !== -1) {
                data.admins.splice(adminIndex, 1);
            }
            
            // Remove attendance records
            data.attendance = data.attendance.filter(a => a.teacherId !== teacherId);
            
            saveData(data);
            loadTeachersList();
            loadAdminStatistics();
            
            alert('Teacher deleted successfully!');
        }
        
        // Load attendance overview (for admin)
        function loadAttendanceOverview() {
            const data = initializeData();
            const today = new Date().toDateString();
            
            // Today's attendance
            const todayTbody = document.getElementById('today-attendance-table').querySelector('tbody');
            todayTbody.innerHTML = '';
            
            data.teachers.forEach(teacher => {
                const attendance = data.attendance.find(a => 
                    a.teacherId === teacher.id && new Date(a.date).toDateString() === today
                );
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${teacher.name}</td>
                    <td>${attendance ? attendance.arrivalTime || '-' : '-'}</td>
                    <td>${attendance ? attendance.departureTime || '-' : '-'}</td>
                    <td><span class="status-badge ${attendance ? (attendance.departureTime ? 'status-present' : attendance.arrivalTime ? 'status-pending' : 'status-absent') : 'status-absent'}">${attendance ? (attendance.departureTime ? 'Present' : attendance.arrivalTime ? 'Arrived' : 'Absent') : 'Absent'}</span></td>
                    <td>
                        ${attendance ? `<button class="action-btn btn-delete" onclick="deleteAttendance(${attendance.id})">Delete</button>` : ''}
                    </td>
                `;
                todayTbody.appendChild(row);
            });
            
            // Attendance history
            filterAttendanceHistory();
        }
        
        // Filter attendance history
        function filterAttendanceHistory() {
            const data = initializeData();
            const teacherId = document.getElementById('attendance-teacher-select').value;
            const startDate = document.getElementById('attendance-start-date').value;
            const endDate = document.getElementById('attendance-end-date').value;
            
            let filteredAttendance = data.attendance;
            
            // Filter by teacher
            if (teacherId) {
                filteredAttendance = filteredAttendance.filter(a => a.teacherId == teacherId);
            }
            
            // Filter by date range
            if (startDate) {
                filteredAttendance = filteredAttendance.filter(a => new Date(a.date) >= new Date(startDate));
            }
            
            if (endDate) {
                filteredAttendance = filteredAttendance.filter(a => new Date(a.date) <= new Date(endDate));
            }
            
            // Sort by date (newest first)
            filteredAttendance.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Display results
            const tbody = document.getElementById('attendance-history-admin').querySelector('tbody');
            tbody.innerHTML = '';
            
            filteredAttendance.forEach(record => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(record.date).toLocaleDateString()}</td>
                    <td>${record.teacherName}</td>
                    <td>${record.arrivalTime || '-'}</td>
                    <td>${record.departureTime || '-'}</td>
                    <td><span class="status-badge ${record.departureTime ? 'status-present' : record.arrivalTime ? 'status-pending' : 'status-absent'}">${record.departureTime ? 'Present' : record.arrivalTime ? 'Arrived' : 'Absent'}</span></td>
                    <td>
                        <button class="action-btn btn-delete" onclick="deleteAttendance(${record.id})">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Delete attendance record
        function deleteAttendance(attendanceId) {
            if (!confirm('Are you sure you want to delete this attendance record?')) return;
            
            const data = initializeData();
            const attendanceIndex = data.attendance.findIndex(a => a.id === attendanceId);
            if (attendanceIndex !== -1) {
                data.attendance.splice(attendanceIndex, 1);
                saveData(data);
                loadAttendanceOverview();
                alert('Attendance record deleted successfully!');
            }
        }
        
        // Load lessons for review
        function loadLessonsForReview() {
            const data = initializeData();
            const tbody = document.getElementById('lessons-for-review').querySelector('tbody');
            tbody.innerHTML = '';
            
            data.lessonNotes.forEach(lesson => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(lesson.date).toLocaleDateString()}</td>
                    <td>${lesson.teacherName}</td>
                    <td>${lesson.subject}</td>
                    <td>${lesson.topic}</td>
                    <td><span class="status-badge ${lesson.status === 'approved' ? 'status-approved' : lesson.status === 'pending' ? 'status-pending' : 'status-revision'}">${lesson.status}</span></td>
                    <td>
                        <button class="action-btn btn-view" onclick="reviewLessonNote(${lesson.id})">Review</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Review lesson note
        function reviewLessonNote(lessonId) {
            const data = initializeData();
            const lesson = data.lessonNotes.find(ln => ln.id === lessonId);
            if (!lesson) return;
            
            // In a real application, you would show a modal
            // For this demo, we'll use prompts
            const grade = prompt('Enter grade (Excellent, Good, Satisfactory, Needs Improvement, Poor):', lesson.grade || 'Good');
            if (grade === null) return;
            
            const feedback = prompt('Enter feedback:', lesson.feedback || '');
            if (feedback === null) return;
            
            const status = confirm('Approve this lesson note?') ? 'approved' : 'revision requested';
            
            // Update lesson note
            lesson.grade = grade;
            lesson.feedback = feedback;
            lesson.status = status;
            
            saveData(data);
            loadLessonsForReview();
            
            alert(`Lesson note ${status === 'approved' ? 'approved' : 'revision requested'} successfully!`);
        }
        
        // Load all assignments
        function loadAllAssignments() {
            const data = initializeData();
            const tbody = document.getElementById('all-assignments').querySelector('tbody');
            tbody.innerHTML = '';
            
            data.assignments.forEach(assignment => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${assignment.title}</td>
                    <td>${assignment.teacherName}</td>
                    <td>${assignment.subject}</td>
                    <td>${new Date(assignment.dueDate).toLocaleDateString()}</td>
                    <td>
                        <button class="action-btn btn-view" onclick="viewAssignment(${assignment.id})">View</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // View assignment
        function viewAssignment(assignmentId) {
            const data = initializeData();
            const assignment = data.assignments.find(a => a.id === assignmentId);
            if (!assignment) return;
            
            alert(`
                Assignment: ${assignment.title}
                Subject: ${assignment.subject}
                Teacher: ${assignment.teacherName}
                Due Date: ${new Date(assignment.dueDate).toLocaleDateString()}
                Description: ${assignment.description}
            ` + (assignment.image ? '\n\nThis assignment includes an image.' : ''));
        }
        
        // Load students list
        function loadStudentsList() {
            const data = initializeData();
            const tbody = document.getElementById('students-list').querySelector('tbody');
            tbody.innerHTML = '';
            
            data.students.forEach(student => {
                const teacher = data.teachers.find(t => t.assignedClass === student.class);
                const teacherName = teacher ? teacher.name : 'Not assigned';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${student.name}</td>
                    <td>${student.username}</td>
                    <td>${student.class}</td>
                    <td>${teacherName}</td>
                    <td>
                        <button class="action-btn btn-edit" onclick="editStudent(${student.id})">Edit</button>
                        <button class="action-btn btn-delete" onclick="deleteStudent(${student.id})">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Add new student
        function addNewStudent(e) {
            e.preventDefault();
            
            const data = initializeData();
            
            const name = document.getElementById('student-name').value;
            const studentClass = document.getElementById('student-class').value;
            const username = document.getElementById('student-username').value;
            const password = document.getElementById('student-password').value;
            
            // Check if username already exists
            if (data.students.find(s => s.username === username && s.class === studentClass)) {
                alert('Username already exists in this class. Please choose a different username.');
                return;
            }
            
            const newStudent = {
                id: Date.now(),
                name,
                class: studentClass,
                username,
                password
            };
            
            data.students.push(newStudent);
            saveData(data);
            
            // Reset form
            document.getElementById('add-student-form').reset();
            
            // Reload students list
            loadStudentsList();
            loadAdminStatistics();
            
            alert('Student added successfully!');
        }
        
        // Edit student
        function editStudent(studentId) {
            const data = initializeData();
            const student = data.students.find(s => s.id === studentId);
            if (!student) return;
            
            // In a real application, you would show a modal or form to edit the student
            // For this demo, we'll use prompts
            const newName = prompt('Enter new name:', student.name);
            if (newName === null) return;
            
            const newClass = prompt('Enter new class:', student.class);
            if (newClass === null) return;
            
            const newUsername = prompt('Enter new username:', student.username);
            if (newUsername === null) return;
            
            // Check if new username already exists in the same class
            if (data.students.find(s => s.username === newUsername && s.class === newClass && s.id !== studentId)) {
                alert('Username already exists in this class. Please choose a different username.');
                return;
            }
            
            // Update student
            student.name = newName;
            student.class = newClass;
            student.username = newUsername;
            
            saveData(data);
            loadStudentsList();
            
            alert('Student updated successfully!');
        }
        
        // Delete student
        function deleteStudent(studentId) {
            if (!confirm('Are you sure you want to delete this student?')) return;
            
            const data = initializeData();
            const studentIndex = data.students.findIndex(s => s.id === studentId);
            if (studentIndex !== -1) {
                data.students.splice(studentIndex, 1);
                saveData(data);
                loadStudentsList();
                loadAdminStatistics();
                alert('Student deleted successfully!');
            }
        }
        
        // Load student assignments
        function loadStudentAssignments() {
            const user = getCurrentUser();
            const data = initializeData();
            
            // Filter assignments for student's class
            const teacher = data.teachers.find(t => t.assignedClass === user.class);
            if (!teacher) {
                document.getElementById('student-assignments').querySelector('tbody').innerHTML = '<tr><td colspan="6">No teacher assigned to your class.</td></tr>';
                return;
            }
            
            const classAssignments = data.assignments.filter(a => a.teacherId === teacher.id);
            
            const tbody = document.getElementById('student-assignments').querySelector('tbody');
            tbody.innerHTML = '';
            
            classAssignments.forEach(assignment => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${assignment.title}</td>
                    <td>${assignment.subject}</td>
                    <td>${assignment.teacherName}</td>
                    <td>${new Date(assignment.dueDate).toLocaleDateString()}</td>
                    <td><span class="status-badge status-pending">Pending</span></td>
                    <td>
                        <button class="action-btn btn-view" onclick="viewAssignment(${assignment.id})">View</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            if (classAssignments.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6">No assignments available for your class.</td></tr>';
            }
        }
        
        // Load student profile
        function loadStudentProfile() {
            const user = getCurrentUser();
            
            document.getElementById('student-fullname').value = user.name || '';
            document.getElementById('student-username-display').value = user.username || '';
            document.getElementById('student-class-profile').value = user.class || '';
            
            const data = initializeData();
            const teacher = data.teachers.find(t => t.assignedClass === user.class);
            document.getElementById('student-teacher').value = teacher ? teacher.name : 'Not assigned';
        }
        
        // Change student password
        function changeStudentPassword() {
            const user = getCurrentUser();
            const data = initializeData();
            
            const newPassword = prompt('Enter new password:');
            if (!newPassword) return;
            
            const confirmPassword = prompt('Confirm new password:');
            if (newPassword !== confirmPassword) {
                alert('Passwords do not match.');
                return;
            }
            
            const studentIndex = data.students.findIndex(s => s.id === user.id);
            if (studentIndex !== -1) {
                data.students[studentIndex].password = newPassword;
                saveData(data);
                setCurrentUser(data.students[studentIndex]);
                alert('Password changed successfully!');
            }
        }
        
        // Load admin profile
        function loadAdminProfile() {
            const user = getCurrentUser();
            const data = initializeData();
            
            document.getElementById('admin-fullname').value = user.name || '';
            document.getElementById('admin-username').value = user.username || '';
            document.getElementById('admin-email').value = user.email || '';
            document.getElementById('admin-phone').value = user.phone || '';
            document.getElementById('school-name-input').value = data.schoolName;
            document.getElementById('auto-logout').value = data.settings.autoLogout || 30;
        }
        
        // Update admin profile
        function updateAdminProfile() {
            const user = getCurrentUser();
            const data = initializeData();
            
            // Find the admin in the data
            let adminIndex = data.admins.findIndex(a => a.id === user.id);
            if (adminIndex === -1) {
                // Check if it's a teacher with admin privileges
                adminIndex = data.teachers.findIndex(t => t.id === user.id && t.isAdmin);
                if (adminIndex !== -1) {
                    data.teachers[adminIndex].email = document.getElementById('admin-email').value;
                    data.teachers[adminIndex].phone = document.getElementById('admin-phone').value;
                    setCurrentUser(data.teachers[adminIndex]);
                }
            } else {
                data.admins[adminIndex].email = document.getElementById('admin-email').value;
                data.admins[adminIndex].phone = document.getElementById('admin-phone').value;
                setCurrentUser(data.admins[adminIndex]);
            }
            
            saveData(data);
            
            alert('Profile updated successfully!');
        }
        
        // Handle admin profile picture upload
        function handleAdminProfilePicUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const user = getCurrentUser();
            const data = initializeData();
            
            // Find the admin in the data
            let adminIndex = data.admins.findIndex(a => a.id === user.id);
            if (adminIndex === -1) {
                // Check if it's a teacher with admin privileges
                adminIndex = data.teachers.findIndex(t => t.id === user.id && t.isAdmin);
                if (adminIndex === -1) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    data.teachers[adminIndex].profilePic = e.target.result;
                    saveData(data);
                    setCurrentUser(data.teachers[adminIndex]);
                    
                    // Update profile picture display
                    document.getElementById('admin-profile-pic').src = e.target.result;
                    
                    alert('Profile picture updated successfully!');
                };
                reader.readAsDataURL(file);
            } else {
                const reader = new FileReader();
                reader.onload = function(e) {
                    data.admins[adminIndex].profilePic = e.target.result;
                    saveData(data);
                    setCurrentUser(data.admins[adminIndex]);
                    
                    // Update profile picture display
                    document.getElementById('admin-profile-pic').src = e.target.result;
                    
                    alert('Profile picture updated successfully!');
                };
                reader.readAsDataURL(file);
            }
        }
        
        // Handle school logo upload
        function handleSchoolLogoUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                // The logo will be saved when the user clicks the "Save School Logo" button
                document.getElementById('save-school-logo').dataset.logo = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        // Save school logo
        function saveSchoolLogo() {
            const logoData = document.getElementById('save-school-logo').dataset.logo;
            if (!logoData) {
                alert('Please select a logo first.');
                return;
            }
            
            const data = initializeData();
            data.schoolLogo = logoData;
            saveData(data);
            
            updateSchoolLogo();
            alert('School logo saved successfully!');
        }
        
        // Save system settings
        function saveSystemSettings() {
            const data = initializeData();
            
            data.schoolName = document.getElementById('school-name-input').value;
            data.settings.autoLogout = parseInt(document.getElementById('auto-logout').value) || 30;
            
            saveData(data);
            updateSchoolLogo();
            
            alert('System settings saved successfully!');
        }
        
        // View lesson note (for teachers)
        function viewLessonNote(lessonId) {
            const data = initializeData();
            const lesson = data.lessonNotes.find(ln => ln.id === lessonId);
            if (!lesson) return;
            
            alert(`
                Subject: ${lesson.subject}
                Topic: ${lesson.topic}
                Date: ${new Date(lesson.date).toLocaleDateString()}
                Status: ${lesson.status}
                Grade: ${lesson.grade || 'Not graded'}
                
                Learning Objectives:
                ${lesson.objectives}
                
                Lesson Content:
                ${lesson.content}
                
                Evaluation Methods:
                ${lesson.evaluation}
                
                ${lesson.feedback ? `Feedback: ${lesson.feedback}` : ''}
            `);
        }
        
        // Logout
        function logout() {
            clearCurrentUser();
            document.getElementById('login-page').style.display = 'flex';
            document.getElementById('teacher-dashboard').style.display = 'none';
            document.getElementById('admin-dashboard').style.display = 'none';
            document.getElementById('student-dashboard').style.display = 'none';
            
            // Reset login form
            document.getElementById('login-form').reset();
            document.getElementById('login-message').textContent = '';
        }
        
        // Initialize the application
        function init() {
            initializeData();
            updateSchoolLogo();
            setupLogin();
            updateDateTime();
            
            // Update time every minute
            setInterval(updateDateTime, 60000);
            
            // Check if user is already logged in
            const user = getCurrentUser();
            if (user && user.portal) {
                showDashboard(user.portal);
            }
        }
        
        // Start the application when the page loads
        window.onload = init;
    </script>
</body>
</html>